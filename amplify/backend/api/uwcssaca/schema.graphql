# This "input" configures a global authorization rule to enable public access to
# all models in this schema. Learn more about authorization rules here: https://docs.amplify.aws/cli/graphql/authorization-rules
# input Account { globalAuthRule: AuthRule = { allow: public } } # FOR TESTING ONLY!

type Account @model(subscriptions: null)
 @auth(rules: [
  { allow: owner, identityClaim: "sub", operations: [create, update, read] },
  { allow: private, operations: [read] }
  ]) 
  {
  account_id: ID! 
  nickname: String! 
  introduction: String
  username: String
  uwemail: String
  role: Int! 
  bridges: [Int] 
  wechat_id: String 
  google_id: String 
  apple_id: String 
  comments: [Comment] @hasMany 
  threads: [Thread] @hasMany 
  has_group: [ThreadGroup] @hasMany 
  owner: String @auth(rules: [
    { allow: owner, operations: [read] },
    { allow: private, operations: [read] }
  ])
}

type Thread @model(subscriptions: null)
 @auth(rules: [
  { allow: owner, identityClaim: "sub", operations: [create, update, read] },
  { allow: private, operations: [read] }
  ])
   {
  thread_id: ID! 
  title: String! 
  content: String! 
  thread_owner: Account! @belongsTo 
  thread_group: ThreadGroup! @belongsTo 
  thread_comments: [Comment] @hasMany 
  thread_likes: Int
  thread_rank: Int 
  group_id: ID @index(name: "byGroupUpdatedAt", sortKeyFields: ["updatedAt"])
  comments_num: Int 
  is_anonymous_thread: Boolean
  special_tag: [Int]
  owner: String @auth(rules: [
    { allow: owner, operations: [read] },
    { allow: private, operations: [read] }
  ])
  updatedAt: AWSDateTime
}

type ThreadGroup @model(subscriptions: null)
 @auth(rules: [
  { allow: owner, identityClaim: "sub", operations: [create, read] },
  { allow: private, operations: [read] }
  ]) {
  group_id: ID!
  group_name: String!
  group_manager: Account @belongsTo
  group_threads: [Thread] @hasMany
  threads_num: Int
  introduction: String
  owner: String @auth(rules: [
    { allow: owner, operations: [read] },
    { allow: private, operations: [read] }
  ])
}

type Comment @model(subscriptions: null)
 @auth(rules: [
  { allow: owner, identityClaim: "sub", operations: [create, update, delete, read] },
  { allow: private, operations: [read] }
  ]) {
  comment_id: ID!
  comment_content: String!
  comment_account: Account! @belongsTo
  comment_thread: Thread! @belongsTo
  parent_comment: Comment @belongsTo
  child_comments: [Comment] @hasMany
  comment_likes: Int
  comment_rank: Int
  is_anonymous_comment: Boolean
  owner: String @auth(rules: [
    { allow: owner, operations: [read] },
    { allow: private, operations: [read] }
  ])
}
